import org.junit.jupiter.api.Test
import org.springframework.test.web.servlet.MockMvc
import org.springframework.test.web.servlet.setup.MockMvcBuilders
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer
import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping
import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter
import org.springframework.web.context.support.StaticWebApplicationContext
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders.options
import org.springframework.test.web.servlet.result.MockMvcResultMatchers.header

@Test
fun `corsConfigurer should apply CORS headers to HTTP requests`() {
    // Création d'un contexte web minimal
    val context = StaticWebApplicationContext()
    val webMvcConfigurer: WebMvcConfigurer = configuration.corsConfigurer()

    val handlerMapping = RequestMappingHandlerMapping()
    val handlerAdapter = RequestMappingHandlerAdapter()
    webMvcConfigurer.addCorsMappings(CorsRegistry())

    val mockMvc: MockMvc = MockMvcBuilders.standaloneSetup()
        .build()

    // Test d'une requête OPTIONS pour vérifier les headers CORS
    mockMvc.perform(options("/any-path"))
        .andExpect(header().string("Access-Control-Allow-Origin", "*"))
}